{"componentChunkName":"component---src-templates-post-js","path":"/amazon-linux-developer-docker-image","result":{"data":{"markdownRemark":{"html":"<p>I've been starting to use AWS a fair bit at work and by extension, the AWS CLI. The CLI itself is pretty easy to set up either on Windows or Linux (in my case WSL2 as that's my go to linux environment now). However once you start relying on additional tools or development languages, often there's more additional set up. This can be a pain to do each time you're setting up a new PC or helping colleagues to set their PC up too.</p>\n<p>For me this rapidly became a good reason to script the whole process using a docker build file to create an image that can be shared and updated easily. This provides an immutable and ephemeral development environment for doing all things AWS. We can bind a local folder to the image while it's running as also connecting via Visual Studio Code is super easy too.</p>\n<p>Let's explore my <a href=\"https://github.com/Alk3m1st/aws-cli-dev-env/blob/master/Dockerfile\">Dockerfile</a> to understand what's going on during the build steps. Most of it is a combination of the utils and tools I've been using at work along with hints from the <a href=\"https://github.com/aws-amplify/amplify-console/blob/master/images/latest/Dockerfile\">build image that AWS uses in the Amplify Console</a>.</p>\n<p>Starting with the Amazon Linux 2 image firstly.</p>\n<p><code class=\"language-text\">FROM amazonlinux:2</code></p>\n<p>Set a working directory.</p>\n<p><code class=\"language-text\">WORKDIR /tmp</code></p>\n<p>Next let's install a few basic, initial prereqs using yum.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">RUN echo 'Install prereqs' &amp;&amp; \\\n    yum <span class=\"token punctuation\">-</span>y install groff less which unzip &amp;&amp; \\\n    yum clean all &amp;&amp; \\\n    rm <span class=\"token punctuation\">-</span>rf /var/cache/yum</code></pre></div>\n<p>Now let's get some pre reqs before we download and build Python (and some others that are useful like nano and git of course!).</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">RUN echo 'Install some pre reqs for Python' &amp;&amp; \\\n    yum <span class=\"token punctuation\">-</span>y install gcc openssl<span class=\"token punctuation\">-</span>devel bzip2<span class=\"token punctuation\">-</span>devel libffi<span class=\"token punctuation\">-</span>devel tar gzip make git nano &amp;&amp; \\\n    yum clean all &amp;&amp; \\\n    rm <span class=\"token punctuation\">-</span>rf /var/cache/yum</code></pre></div>\n<p>Download the Pythons and extract into the /opt folder.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">WORKDIR /opt\nRUN echo 'Download and extract Python 3.8' &amp;&amp; \\\n    curl \"https<span class=\"token punctuation\">:</span>//www.python.org/ftp/python/3.8.6/Python<span class=\"token punctuation\">-</span>3.8.6.tgz\" <span class=\"token punctuation\">-</span>o \"Python<span class=\"token punctuation\">-</span>3.8.6.tgz\" &amp;&amp; \\\n    tar xzf Python<span class=\"token punctuation\">-</span>3.8.6.tgz</code></pre></div>\n<p>Now we actually build and install it. Using <code class=\"language-text\">altinstall</code> allows our version to be installed without affecting the default one of the system as that can sometimes make things go screwy.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">RUN echo 'Install Python 3.8' &amp;&amp; \\\n    cd Python<span class=\"token punctuation\">-</span>3.8.6 &amp;&amp; \\\n    ./configure <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>enable<span class=\"token punctuation\">-</span>optimizations &amp;&amp; \\\n    make altinstall &amp;&amp; \\\n    rm <span class=\"token punctuation\">-</span>f /opt/Python<span class=\"token punctuation\">-</span>3.8.6.tgz</code></pre></div>\n<p>Finally for Python I like to set up an alias for the version we installed.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">RUN echo 'Alias for python3.8' &amp;&amp; \\\n    echo \"alias python=python3.8\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> ~/.bashrc &amp;&amp; \\\n    source ~/.bashrc</code></pre></div>\n<p>Now on to Node JS which is pretty important (in my case as a mostly front-end developer of late). There's also global tools we install that need node. We are using Node Version Manager (NVM) as it's great for installing, running and switching different versions of node. In our case we install the latest stable versions (long term support) of Node 8, 10 and 12 (carbon, dubnium and erbium respectively). We'll also tell NVM to use version 12 by default.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">RUN echo 'Install node via nvm' &amp;&amp; \\\n    curl <span class=\"token punctuation\">-</span>o<span class=\"token punctuation\">-</span> https<span class=\"token punctuation\">:</span>//raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh <span class=\"token punctuation\">|</span> bash\nRUN /bin/bash <span class=\"token punctuation\">-</span>c \". ~/.nvm/nvm.sh &amp;&amp; \\\n    nvm install lts/carbon &amp;&amp; \\\n    nvm install lts/dubnium &amp;&amp; \\\n    nvm install lts/erbium &amp;&amp; \\\n    nvm use lts/erbium &amp;&amp; \\\n    nvm alias default node &amp;&amp; nvm cache clear\"  <span class=\"token comment\"># Default to the latest node and empty cache</span></code></pre></div>\n<p>Let's install some important and usefull CLI tools. Namely the AWS CLI, SAM CLI and CDK CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># Install AWS CLI</span>\nRUN echo 'Install AWS CLI' &amp;&amp; \\\n    /bin/bash <span class=\"token punctuation\">-</span>c \"python3.8 <span class=\"token punctuation\">-</span>m pip install awscli &amp;&amp; rm <span class=\"token punctuation\">-</span>rf /var/cache/apk/*\"\n\n<span class=\"token comment\"># Install SAM CLI</span>\nRUN echo 'Install SAM CLI' &amp;&amp; \\\n    /bin/bash <span class=\"token punctuation\">-</span>c \"python3.8 <span class=\"token punctuation\">-</span>m pip install aws<span class=\"token punctuation\">-</span>sam<span class=\"token punctuation\">-</span>cli\"\n\n<span class=\"token comment\"># Install CDK CLI</span>\nRUN echo 'Install CDK CLI' &amp;&amp; \\\n    source ~/.bashrc &amp;&amp; \\\n    /bin/bash <span class=\"token punctuation\">-</span>c \"npm install <span class=\"token punctuation\">-</span>g aws<span class=\"token punctuation\">-</span>cdk\"</code></pre></div>\n<p>Well that's about it. You can continue to add your own commonly used tools or set things up in the .bashrc file (or set up another shell I guess). Finally I set an entry point and then it's ready to build and run.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">ENTRYPOINT <span class=\"token punctuation\">[</span> <span class=\"token string\">\"bash\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-c\"</span> <span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Build the Dockerfile</h2>\n<p><code class=\"language-text\">docker build -t &lt;tag-name&gt;:&lt;version&gt; .</code></p>\n<h2>Run the container</h2>\n<p><code class=\"language-text\">docker container run -it &lt;tag-name&gt;:&lt;version&gt; /bin/bash</code></p>\n<p>e.g. <code class=\"language-text\">docker container run -it aws-dev-env:v0.2 /bin/bash</code></p>\n<p>If you want to mount a working directory as a volume that's straight forward also, e.g.</p>\n<p><code class=\"language-text\">docker container run -v /mnt/c/Users/user/path/to/folder/:/tmp -it aws-dev-env:v0.2 /bin/bash</code></p>\n<p>Essentially the command above mounts the absolute path on the host machine to a folder in the container storage (folder will be created if it doesn't exist already). You can mount multiple containers by just passing more -v flags with the same structure.</p>","frontmatter":{"date":"November 12, 2020","path":"/amazon-linux-developer-docker-image","title":"Amazon Linux Developer Docker Image"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}